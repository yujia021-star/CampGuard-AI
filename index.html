<!DOCTYPE html>
<html lang="ja">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>CampIntel Pro</title>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
Â  Â  <style>
Â  Â  Â  Â  :root { --bg: #0b0f1a; --card: #1e293b; --accent: #38bdf8; --text: #f1f5f9; --warning: #ef4444; --general: #10b981; }
Â  Â  Â  Â  body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 90px; }
Â  Â  Â  Â  .container { max-width: 480px; margin: 0 auto; padding: 15px; }
Â  Â  Â  Â  .page { display: none; animation: fadeIn 0.3s ease; } .active { display: block; }
Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* å³ä¸Šå›ºå®šãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ */
Â  Â  Â  Â  .logout-top {Â 
Â  Â  Â  Â  Â  Â  position: fixed; top: 15px; right: 15px; z-index: 2000;Â 
Â  Â  Â  Â  Â  Â  background: rgba(239, 68, 68, 0.15); color: #ef4444;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 10px;Â 
Â  Â  Â  Â  Â  Â  padding: 6px 12px; font-size: 0.7rem; font-weight: bold; cursor: pointer;
Â  Â  Â  Â  Â  Â  backdrop-filter: blur(4px); display: none;
Â  Â  Â  Â  }

Â  Â  Â  Â  #loginOverlay { position: fixed; inset: 0; background: var(--bg); z-index: 3000; display: flex; align-items: center; justify-content: center; padding: 20px; }
Â  Â  Â  Â  .login-card { background: var(--card); width: 100%; max-width: 350px; padding: 30px; border-radius: 28px; border: 1px solid rgba(255,255,255,0.1); text-align: center; }
Â  Â  Â  Â  .main-card { background: var(--card); border-radius: 28px; padding: 20px; text-align: center; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.08); }
Â  Â  Â  Â  .gauge-outer { position: relative; height: 160px; margin-bottom: 10px; }
Â  Â  Â  Â  .score-display { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; }
Â  Â  Â  Â  .score-num { font-size: 5rem; font-weight: 900; line-height: 1; }
Â  Â  Â  Â  input, textarea, select { width: 100%; padding: 14px; border-radius: 14px; border: 1px solid #334155; background: #0f172a; color: white; margin-bottom: 12px; outline: none; box-sizing: border-box; font-size: 16px; }
Â  Â  Â  Â  .btn-primary { background: var(--accent); color: #0f172a; border: none; border-radius: 14px; padding: 14px; font-weight: bold; width: 100%; cursor: pointer; }
Â  Â  Â  Â  .tag { font-size: 0.75rem; color: var(--accent); font-weight: bold; text-align: left; margin-top: 20px; margin-bottom: 8px; text-transform: uppercase; }
Â  Â  Â  Â  .insight-box { padding: 16px; border-radius: 20px; font-size: 0.95rem; margin-bottom: 12px; text-align: left; }
Â  Â  Â  Â  .local-info { border-left: 4px solid var(--warning); background: rgba(239, 68, 68, 0.08); }
Â  Â  Â  Â  .nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(30, 41, 59, 0.95); display: flex; justify-content: space-around; padding: 15px 0 25px 0; border-top: 1px solid rgba(255,255,255,0.1); z-index: 1000; }
Â  Â  Â  Â  .nav-item { cursor: pointer; font-size: 0.65rem; opacity: 0.4; color: white; text-align: center; flex: 1; }
Â  Â  Â  Â  .nav-item.active { opacity: 1; color: var(--accent); }
Â  Â  Â  Â  .loading { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 4000; }
Â  Â  Â  Â  .timeline { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; }
Â  Â  Â  Â  .t-item { background: #334155; padding: 10px; border-radius: 12px; min-width: 65px; text-align: center; }
Â  Â  </style>
</head>
<body>

<div id="loader" class="loading">è§£æä¸­...</div>

<div id="logoutBtn" class="logout-top" onclick="logout()">LOGOUT</div>

<div id="loginOverlay">
Â  Â  <div class="login-card">
Â  Â  Â  Â  <h2>CampIntel Pro</h2>
Â  Â  Â  Â  <input type="text" id="uid" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼ID">
Â  Â  Â  Â  <input type="password" id="pwd" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
Â  Â  Â  Â  <button class="btn-primary" onclick="attemptLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
Â  Â  </div>
</div>

<div class="container" id="mainApp" style="display:none;">
Â  Â  <div id="pageDiag" class="page active">
Â  Â  Â  Â  <h2 style="text-align:center;">CAMPINTEL <span style="color:var(--accent)">PRO</span></h2>
Â  Â  Â  Â  <div style="display:flex; gap:8px; margin-bottom:20px;">
Â  Â  Â  Â  Â  Â  <input type="text" id="loc" placeholder="ã‚­ãƒ£ãƒ³ãƒ—å ´å" style="margin:0;">
Â  Â  Â  Â  Â  Â  <button class="btn-primary" onclick="diagnose()" style="width:80px; padding:0;">åˆ¤å®š</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="resultArea" style="display:none;">
Â  Â  Â  Â  Â  Â  <div class="main-card">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="resLoc" style="font-size:0.9rem; color:var(--accent); font-weight: bold;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="gauge-outer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="gaugeChart"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="score-display">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="resScore" class="score-num">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="resReason" style="font-size:0.75rem; opacity:0.6;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="insightContainer"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="resTimeline" class="timeline"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>

<div id="pageHazard" class="page">
Â  Â  Â  Â  <h2 style="text-align:center;">AREA <span style="color:var(--accent)">HAZARD</span></h2>
Â  Â  Â  Â  <div class="main-card">
Â  Â  Â  Â  Â  Â  <input type="datetime-local" id="hDate">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <select id="hRegion" onchange="updatePrefectures()">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="" disabled selected>ã‚¿ãƒƒãƒ—ã—ã¦åœ°æ–¹ã‚’é¸æŠ</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="åŒ—æµ·é“">åŒ—æµ·é“</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="æ±åŒ—">æ±åŒ—</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="åŒ—é–¢æ±">åŒ—é–¢æ±</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="å—é–¢æ±">å—é–¢æ±</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="ç”²ä¿¡è¶Š">ç”²ä¿¡è¶Š</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="åŒ—é™¸">åŒ—é™¸</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="æ±æµ·">æ±æµ·</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="è¿‘ç•¿">è¿‘ç•¿</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="ä¸­å›½">ä¸­å›½</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="å››å›½">å››å›½</option>
Â  Â  Â  Â  Â  Â  Â  Â  <option value="ä¹å·ãƒ»æ²–ç¸„">ä¹å·ãƒ»æ²–ç¸„</option>
Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  <select id="hArea">
Â  Â  Â  Â  Â  Â  Â  Â  <option value="">â†‘åœ°æ–¹ã‚’å…ˆã«é¸æŠã—ã¦ãã ã•ã„</option>
Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  <button class="btn-primary" onclick="loadHazardMap()">36æ™‚é–“ãƒªã‚¹ã‚¯ã‚’ã‚¹ã‚­ãƒ£ãƒ³</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="hazardList"></div>
Â  Â  </div>

Â  Â  <div id="pageDiary" class="page">
Â  Â  Â  Â  <h2 style="text-align:center;">æ—¥è¨˜ã‚’è¨˜éŒ²</h2>
Â  Â  Â  Â  <div class="main-card" style="text-align:left;">
Â  Â  Â  Â  Â  Â  <input type="date" id="dDate">
Â  Â  Â  Â  Â  Â  <input type="text" id="dPlace" placeholder="ğŸ“ ã‚­ãƒ£ãƒ³ãƒ—å ´å">
Â  Â  Â  Â  Â  Â  <input type="text" id="dTopic" placeholder="ğŸ·ï¸ ã‚¿ã‚¤ãƒˆãƒ«">
Â  Â  Â  Â  Â  Â  <textarea id="dContent" placeholder="å†…å®¹..."></textarea>
Â  Â  Â  Â  Â  Â  <button class="btn-primary" onclick="saveDiary()">ç™»éŒ²</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="pageHistory" class="page">
Â  Â  Â  Â  <h2 style="text-align:center;">å±¥æ­´</h2>
Â  Â  Â  Â  <div id="historyList"></div>
Â  Â  </div>
</div>

<div class="nav" id="mainNav" style="display:none;">
Â  Â  <div class="nav-item active" onclick="switchPage('pageDiag', this)">å±é™ºåˆ¤å®š</div>
Â  Â  <div class="nav-item" onclick="switchPage('pageHazard', this)">ãƒã‚¶ãƒ¼ãƒ‰</div>
Â  Â  <div class="nav-item" onclick="switchPage('pageDiary', this)">æ—¥è¨˜ç™»éŒ²</div>
Â  Â  <div class="nav-item" onclick="loadHistory(this)">å±¥æ­´</div>
</div>

<script>
Â  Â  const gasUrl = "https://script.google.com/macros/s/AKfycbxTXEtRztOBX5a0F3UgFbwCBtHglu-Ynqz3qeGUoEK8YTFyX4SlGiwbeMegloMWhMoX/exec";
Â  Â  let myChart;

Â  Â  window.onload = function() {
Â  Â  Â  Â  if (localStorage.getItem('campGuardUser')) showApp();
Â  Â  };

Â  Â  const regionMap = {
Â  Â  Â  Â  "åŒ—æµ·é“": ["åŒ—æµ·é“"], "æ±åŒ—": ["é’æ£®", "å²©æ‰‹", "å®®åŸ", "ç§‹ç”°", "å±±å½¢", "ç¦å³¶"],
Â  Â  Â  Â  "åŒ—é–¢æ±": ["èŒ¨åŸ", "æ ƒæœ¨", "ç¾¤é¦¬"], "å—é–¢æ±": ["åŸ¼ç‰", "åƒè‘‰", "æ±äº¬", "ç¥å¥ˆå·"],
Â  Â  Â  Â  "ç”²ä¿¡è¶Š": ["å±±æ¢¨", "é•·é‡", "æ–°æ½Ÿ"], "åŒ—é™¸": ["å¯Œå±±", "çŸ³å·", "ç¦äº•"],
Â  Â  Â  Â  "æ±æµ·": ["å²é˜œ", "é™å²¡", "æ„›çŸ¥", "ä¸‰é‡"], "è¿‘ç•¿": ["æ»‹è³€", "äº¬éƒ½", "å¤§é˜ª", "å…µåº«", "å¥ˆè‰¯", "å’Œæ­Œå±±"],
Â  Â  Â  Â  "ä¸­å›½": ["é³¥å–", "å³¶æ ¹", "å²¡å±±", "åºƒå³¶", "å±±å£"], "å››å›½": ["å¾³å³¶", "é¦™å·", "æ„›åª›", "é«˜çŸ¥"],
Â  Â  Â  Â  "ä¹å·ãƒ»æ²–ç¸„": ["ç¦å²¡", "ä½è³€", "é•·å´", "ç†Šæœ¬", "å¤§åˆ†", "å®®å´", "é¹¿å…å³¶", "æ²–ç¸„"]
Â  Â  };

Â  Â  function updatePrefectures() {
Â  Â  Â  Â  const region = document.getElementById('hRegion').value;
Â  Â  Â  Â  const areaSelect = document.getElementById('hArea');
Â  Â  Â  Â  const prefs = regionMap[region] || [];
Â  Â  Â  Â  let html = `<option value="${region}">ğŸš© ${region}å…¨åŸŸã‚’ã‚¹ã‚­ãƒ£ãƒ³</option>`;
Â  Â  Â  Â  prefs.forEach(p => { html += `<option value="${p}">${p}</option>`; });
Â  Â  Â  Â  areaSelect.innerHTML = html;
Â  Â  }

Â  Â  function showApp() {Â 
Â  Â  Â  Â  document.getElementById('loginOverlay').style.display = 'none';Â 
Â  Â  Â  Â  document.getElementById('mainApp').style.display = 'block';Â 
Â  Â  Â  Â  document.getElementById('mainNav').style.display = 'flex';
Â  Â  Â  Â  document.getElementById('logoutBtn').style.display = 'block';
Â  Â  }

Â  Â  function logout() { localStorage.removeItem('campGuardUser'); location.reload(); }

Â  Â  async function attemptLogin() {
Â  Â  Â  Â  const uid = document.getElementById('uid').value.trim();
Â  Â  Â  Â  const pwd = document.getElementById('pwd').value.trim();
Â  Â  Â  Â  if(!uid || !pwd) return;
Â  Â  Â  Â  document.getElementById('loader').style.display = 'flex';
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch(`${gasUrl}?mode=login&uid=${encodeURIComponent(uid)}&pwd=${encodeURIComponent(pwd)}`);
Â  Â  Â  Â  Â  Â  if (await res.text() === "success") { localStorage.setItem('campGuardUser', uid); showApp(); } else { alert("å¤±æ•—"); }
Â  Â  Â  Â  } catch(e) { alert("ã‚¨ãƒ©ãƒ¼"); }
Â  Â  Â  Â  document.getElementById('loader').style.display = 'none';
Â  Â  }

Â  Â  async function diagnose() {
Â  Â  Â  Â  document.getElementById('loader').style.display = 'flex';
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const loc = document.getElementById('loc').value;
Â  Â  Â  Â  Â  Â  const res = await fetch(`${gasUrl}?mode=diagnose&place=${encodeURIComponent(loc)}`);
Â  Â  Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  Â  Â  document.getElementById('resultArea').style.display = 'block';
Â  Â  Â  Â  Â  Â  document.getElementById('resLoc').innerText = data.locationName;
Â  Â  Â  Â  Â  Â  document.getElementById('resScore').innerText = data.score;
Â  Â  Â  Â  Â  Â  // å…ƒã®ãƒ‡ã‚¶ã‚¤ãƒ³é€šã‚Šã€ç†ç”±ã ã‘ã‚’è¡¨ç¤º
Â  Â  Â  Â  Â  Â  document.getElementById('resReason').innerText = `(${data.scoreReason})`;
Â  Â  Â  Â  Â  Â  updateGauge(data.score);
Â  Â  Â  Â  Â  Â  let html = `<div style="background:rgba(56, 189, 248, 0.1); padding:14px; border-radius:16px; margin:12px 0; font-weight:bold; border:1px solid rgba(56,189,248,0.3);">${data.alertTitle}</div>`;
Â  Â  Â  Â  Â  Â  if(data.localInsights?.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  html += `<div class="tag">ğŸš¨ å…ˆäººã®å£°</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  data.localInsights.forEach(i => { html += `<div class="insight-box local-info"><div>${i.content}</div></div>`; });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  html += `<div class="tag">ğŸ›¡ï¸ æ¨å¥¨</div><div class="insight-box" style="background:rgba(255,255,255,0.05);">${data.checkList.map(item => `<div>âœ… ${item}</div>`).join('')}</div>`;
Â  Â  Â  Â  Â  Â  document.getElementById('insightContainer').innerHTML = html;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ä¸‹éƒ¨ã®æ°—æ¸©ã«ã€ŒğŸ’§é›¨ã€ã¨ã€ŒğŸ’¨é¢¨ã€ã‚’å…ƒã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’å´©ã•ãšè¿½åŠ 
Â  Â  Â  Â  Â  Â  // --- HTMLã® diagnose é–¢æ•°å†…ã® resTimeline éƒ¨åˆ†ã‚’ä»¥ä¸‹ã«å·®ã—æ›¿ãˆ ---
document.getElementById('resTimeline').innerHTML = data.timeline.map(t => `
Â  Â  <div class="t-item" style="min-width:85px; padding:10px 5px; flex-shrink:0;">
Â  Â  Â  Â  <div style="font-size:0.75rem; opacity:0.8; margin-bottom:2px;">${t.time}</div>
Â  Â  Â  Â  <img src="https://openweathermap.org/img/wn/${t.icon}.png" width="35" style="margin:0 auto;">
Â  Â  Â  Â  <div style="font-weight:bold; font-size:1.1rem; margin-bottom:8px;">${t.temp}â„ƒ</div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div style="font-size:0.7rem; text-align:left; padding-left:10px; line-height:1.4;">
Â  Â  Â  Â  Â  Â  <div style="color:#38bdf8;">â˜”ï¸ ${t.rain||0}mm</div>
Â  Â  Â  Â  Â  Â  <div style="color:#a855f7;">ğŸ’§ ${t.humidity}%</div>
Â  Â  Â  Â  Â  Â  <div style="color:#f59e0b;">ğŸŒ¬ï¸ ${t.wind}m/s</div>
Â  Â  Â  Â  </div>
Â  Â  </div>`).join('');
Â  Â  Â  Â  } catch(e) { alert("åˆ¤å®šã‚¨ãƒ©ãƒ¼"); }
Â  Â  Â  Â  document.getElementById('loader').style.display = 'none';
Â  Â  }

Â  Â  async function loadHazardMap() {
Â  Â  Â  Â  const area = document.getElementById('hArea').value;
Â  Â  Â  Â  const listDiv = document.getElementById('hazardList');
Â  Â  Â  Â  if (!area) return alert("ã‚¨ãƒªã‚¢ã‚’é¸æŠã—ã¦ãã ã•ã„");
Â  Â  Â  Â  listDiv.innerHTML = '<div style="color:white; text-align:center; padding:20px;">ã‚¹ã‚­ãƒ£ãƒ³ä¸­...</div>';
Â  Â  Â  Â  const getPos = () => new Promise(res => {
Â  Â  Â  Â  Â  Â  navigator.geolocation.getCurrentPosition(res, () => res(null), {timeout: 5000});
Â  Â  Â  Â  });
Â  Â  Â  Â  const pos = await getPos();
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const res = await fetch(`${gasUrl}?mode=areaHazard&area=${encodeURIComponent(area)}`);
Â  Â  Â  Â  Â  Â  const results = await res.json();
Â  Â  Â  Â  Â  Â  if (!results || results.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  listDiv.innerHTML = '<p style="text-align:center;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (pos) {
Â  Â  Â  Â  Â  Â  Â  Â  results.forEach(pt => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pt.dist = Math.sqrt(Math.pow(pt.lat - pos.coords.latitude, 2) + Math.pow(pt.lon - pos.coords.longitude, 2));
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  results.sort((a, b) => (a.dist || 0) - (b.dist || 0));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  listDiv.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â  results.forEach(res => {
Â  Â  Â  Â  Â  Â  Â  Â  const color = res.score >= 70 ? '#ef4444' : (res.score >= 40 ? '#f59e0b' : '#10b981');
Â  Â  Â  Â  Â  Â  Â  Â  listDiv.innerHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="background:rgba(255,255,255,0.05); border-left:8px solid ${color}; padding:15px; border-radius:18px; margin-bottom:15px; color:white;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-weight:bold;">ğŸ“ ${res.name}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-weight:bold; color:${color}">${res.score}ç‚¹</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size:0.8rem; margin:5px 0; opacity:0.7;">ğŸ’¨é¢¨:${res.maxWind}m / ğŸŒ¡æœ€ä½:${res.minTemp}â„ƒ</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="font-size:0.85rem;"><strong>ç†ç”±:</strong> ${res.reason}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:8px; margin-top:10px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="jumpToDiag('${res.name}')" style="flex:1; background:var(--accent); color:#0b0f1a; border:none; border-radius:10px; padding:8px; font-size:0.75rem; font-weight:bold; cursor:pointer;">è©³ç´°ã‚’è§£æ</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="window.open('https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(res.name + ' ã‚­ãƒ£ãƒ³ãƒ—å ´')}', '_blank')" style="flex:1; background:rgba(255,255,255,0.1); color:white; border:none; border-radius:10px; padding:8px; font-size:0.75rem; cursor:pointer;">MAP</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } catch (err) { listDiv.innerHTML = '<div style="color:red; text-align:center;">ã‚¨ãƒ©ãƒ¼</div>'; }
Â  Â  }

Â  Â  // è©³ç´°ãƒšãƒ¼ã‚¸ã¸ã‚¸ãƒ£ãƒ³ãƒ—ç”¨
Â  Â  function jumpToDiag(name) {
Â  Â  Â  Â  document.getElementById('loc').value = name;
Â  Â  Â  Â  switchPage('pageDiag', document.querySelectorAll('.nav-item')[0]);
Â  Â  Â  Â  diagnose();
Â  Â  }

Â  Â  function updateGauge(score) {
Â  Â  Â  Â  const ctx = document.getElementById('gaugeChart').getContext('2d');
Â  Â  Â  Â  const color = score >= 70 ? '#ef4444' : (score >= 40 ? '#f59e0b' : '#10b981');
Â  Â  Â  Â  if (myChart) myChart.destroy();
Â  Â  Â  Â  myChart = new Chart(ctx, { type: 'doughnut', data: { datasets: [{ data: [score, 100 - score], backgroundColor: [color, 'rgba(255,255,255,0.05)'], circumference: 180, rotation: 270, cutout: '90%' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: false, tooltip: false } } });
Â  Â  }

Â  Â  async function saveDiary() {
Â  Â  Â  Â  const d = ["dDate","dPlace","dTopic","dContent"].map(id => document.getElementById(id).value);
Â  Â  Â  Â  if(d.some(v => !v)) return alert("æœªå…¥åŠ›");
Â  Â  Â  Â  document.getElementById('loader').style.display = 'flex';
Â  Â  Â  Â  await fetch(`${gasUrl}?mode=postDiary&place=${encodeURIComponent(d[1])}&topic=${encodeURIComponent(d[2])}&content=${encodeURIComponent(d[3])}&campDate=${encodeURIComponent(d[0])}&uid=${encodeURIComponent(localStorage.getItem('campGuardUser'))}`, {mode: 'no-cors'});
Â  Â  Â  Â  alert("ç™»éŒ²å®Œäº†");
Â  Â  Â  Â  switchPage('pageDiag', document.querySelectorAll('.nav-item')[0]);
Â  Â  Â  Â  document.getElementById('loader').style.display = 'none';
Â  Â  }

Â  Â  async function loadHistory(el) {
Â  Â  Â  Â  switchPage('pageHistory', el);
Â  Â  Â  Â  const list = document.getElementById('historyList');
Â  Â  Â  Â  list.innerHTML = "èª­è¾¼ä¸­...";
Â  Â  Â  Â  const res = await fetch(`${gasUrl}?mode=getDiaries&uid=${encodeURIComponent(localStorage.getItem('campGuardUser'))}`);
Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  list.innerHTML = data.map(d => `<div class="main-card" style="text-align:left;"><div style="color:var(--accent); font-size:0.7rem;">${d.campDate}</div><b>${d.topic}</b><p>${d.content}</p></div>`).join('') || "ãªã—";
Â  Â  }

Â  Â  function switchPage(id, el) {
Â  Â  Â  Â  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
Â  Â  Â  Â  document.getElementById(id).classList.add('active');
Â  Â  Â  Â  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
Â  Â  Â  Â  el.classList.add('active');
Â  Â  }
</script>
</body>
</html>
