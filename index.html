async function diagnose() {
        document.getElementById('loader').style.display = 'flex';
        try {
            const res = await fetch(`${gasUrl}?mode=diagnose&place=${encodeURIComponent(document.getElementById('loc').value)}`);
            const data = await res.json();
            
            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('resLoc').innerText = data.locationName;
            document.getElementById('resScore').innerText = data.score;
            updateGauge(data.score);

            // è­¦å‘Šã‚¿ã‚¤ãƒˆãƒ«ã€ã‚¹ã‚³ã‚¢æ ¹æ‹ ã€ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
            let html = `
                <div style="font-size:0.7rem; opacity:0.8; margin-bottom:10px;">${data.scoreReason}</div>
                <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; margin:10px 0; font-size:0.9rem;">
                    ${data.alertTitle}
                </div>
                <div style="text-align:left; margin-top:20px;">
                    <div class="tag">ğŸ›¡ï¸ æ¨å¥¨è£…å‚™ãƒã‚§ãƒƒã‚¯</div>
                    <div class="bubble" style="line-height:1.8;">
                        ${data.checkList.map(item => `<div>âœ… ${item}</div>`).join('')}
                    </div>
                </div>
            `;

            // è©³ç´°æ•°å€¤ï¼ˆè¬ã®é‡è¤‡æ–‡å­—ã‚’å‰Šé™¤ï¼‰
            html += `
                <div style="display:grid; grid-template-columns:1fr 1fr 1fr 1fr; font-size:0.7rem; border-top:1px solid rgba(255,255,255,0.1); padding-top:20px; margin-top:15px;">
                    <div>æœ€å¤§é¢¨é€Ÿ<br><b>${data.maxWind}m/s</b></div>
                    <div>æœ€é«˜æ°—æ¸©<br><b>${data.maxTemp}â„ƒ</b></div>
                    <div>æœ€ä½æ°—æ¸©<br><b>${data.minTemp}â„ƒ</b></div>
                    <div>æœ€å¤§é›¨é‡<br><b>${data.maxRain}mm</b></div>
                </div>
            `;

            document.getElementById('insightContainer').innerHTML = html;

            // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆ12å€‹åˆ†è¡¨ç¤ºã€å½“æ—¥ã€œç¿Œæ—¥ï¼‰
            document.getElementById('resTimeline').innerHTML = data.timeline.map(t => `
                <div class="t-item">
                    <div style="font-size:0.6rem; color:#38bdf8;">${t.time}</div>
                    <img src="https://openweathermap.org/img/wn/${t.icon}.png" width="30">
                    <div>${t.temp}â„ƒ</div>
                </div>`).join('');

        } catch(e) { alert("ã‚¨ãƒ©ãƒ¼: " + e.message); }
        document.getElementById('loader').style.display = 'none';
    }
