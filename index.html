<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampGuard AI</title>
    <style>
        body { font-family: sans-serif; background: #0a0c10; color: #fff; margin: 0; padding: 20px; }
        .card { background: #161b22; border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        input, button { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; }
        button { background: #58a6ff; color: #000; font-weight: bold; }
        #resultArea { display: none; text-align: center; }
        .score-num { font-size: 3rem; font-weight: bold; color: #58a6ff; }
        .timeline { display: flex; overflow-x: auto; gap: 10px; padding: 10px 0; }
        .t-item { min-width: 50px; background: rgba(255,255,255,0.1); padding: 5px; border-radius: 5px; font-size: 0.8rem; }
        .insight-box { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; margin: 5px 0; font-size: 0.9rem; text-align: left; }
    </style>
</head>
<body>

<div id="loginArea" class="card">
    <h2>CampGuard Login</h2>
    <input type="text" id="uid" placeholder="User ID">
    <input type="password" id="pwd" placeholder="Password">
    <button onclick="login()">Login</button>
</div>

<div id="mainArea" style="display:none;">
    <div class="card">
        <input type="text" id="loc" placeholder="„Ç≠„É£„É≥„ÉóÂ†¥Âêç" value="Â∞èÂÄâÊ©ã">
        <button onclick="diagnose()">Ë®∫Êñ≠ÈñãÂßã</button>
    </div>

    <div id="resultArea" class="card">
        <h3 id="resLoc">---</h3>
        <div class="score-num" id="resScore">0</div>
        <p id="resReason"></p>
        <div class="timeline" id="resTimeline"></div>
        <div id="insightContainer"></div>
    </div>

    <div class="card">
        <h4>Êó•Ë®ò„ÇíÊäïÁ®ø„Åô„Çã</h4>
        <input type="text" id="diaryContent" placeholder="‰æãÔºöÂú∞Èù¢„ÅåÁ°¨„Åã„Å£„Åü„ÄÅÈùô„Åã„Å†„Å£„Åü">
        <button onclick="postDiary()">ÊäïÁ®ø</button>
    </div>
</div>

<script>
    const gasUrl = "https://script.google.com/macros/s/AKfycbyqDTFt6HyyWfDLJJTkB2hQfSik9oJJfmIJBsRZ4U_kacbxYjlE2lB759s7scGMhaHx/exec";
    let currentUser = "";

    async function login() {
        const res = await fetch(`${gasUrl}?mode=login&uid=${document.getElementById('uid').value}&pwd=${document.getElementById('pwd').value}`);
        if(await res.text() === "success") {
            currentUser = document.getElementById('uid').value;
            document.getElementById('loginArea').style.display = 'none';
            document.getElementById('mainArea').style.display = 'block';
        } else { alert("Â§±Êïó"); }
    }

    async function diagnose() {
        const res = await fetch(`${gasUrl}?mode=diagnose&place=${encodeURIComponent(document.getElementById('loc').value)}`);
        const data = await res.json();
        document.getElementById('resultArea').style.display = 'block';
        document.getElementById('resLoc').innerText = data.locationName;
        document.getElementById('resScore').innerText = data.score;
        document.getElementById('resReason').innerText = data.scoreReason;
        
        document.getElementById('resTimeline').innerHTML = data.timeline.map(t => `<div class="t-item">${t.time}<br>${t.temp}‚ÑÉ</div>`).join('');
        document.getElementById('insightContainer').innerHTML = data.localInsights.map(i => `<div class="insight-box">üìî ${i.content}</div>`).join('');
    }

    async function postDiary() {
        const content = document.getElementById('diaryContent').value;
        const loc = document.getElementById('loc').value;
        await fetch(`${gasUrl}?mode=postDiary&uid=${currentUser}&place=${encodeURIComponent(loc)}&content=${encodeURIComponent(content)}`);
        alert("ÊäïÁ®øÂÆå‰∫Ü");
        document.getElementById('diaryContent').value = "";
    }
</script>
</body>
</html>
